<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
<title>Quintessence v2</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.2/babel.min.js"></script>
<style>
  *{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
  html,body{height:100%;background:#080810;overscroll-behavior:none}
  #root{height:100%}
  button{font-family:inherit;border:none;outline:none;cursor:pointer}
  button:active{opacity:.75;transform:scale(.97)}
  ::-webkit-scrollbar{width:3px;background:#0d0d18}
  ::-webkit-scrollbar-thumb{background:#2a2a3a;border-radius:3px}
  @keyframes pulse{0%,100%{opacity:.6}50%{opacity:1}}
  @keyframes ripple{0%{transform:scale(1);opacity:.6}100%{transform:scale(1.8);opacity:0}}
  @keyframes fadeIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}
  .fade-in{animation:fadeIn .25s ease forwards}
</style>
</head>
<body>
<div id="root"></div>

<script type="text/babel">
const {useState,useEffect,useRef,useCallback,useMemo}=React;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  MUSIC THEORY
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const CIRCLE_MAJ  = ['C','G','D','A','E','B','Fâ™¯','Dâ™­','Aâ™­','Eâ™­','Bâ™­','F'];
const CIRCLE_MIN  = ['Am','Em','Bm','Fâ™¯m','Câ™¯m','Gâ™¯m','Dâ™¯m','Bâ™­m','Fm','Cm','Gm','Dm'];
const CHROMATIC   = ['C','Câ™¯','D','Dâ™¯','E','F','Fâ™¯','G','Gâ™¯','A','Aâ™¯','B'];
const ENHARMONIC  = {'Dâ™­':'Câ™¯','Aâ™­':'Gâ™¯','Eâ™­':'Dâ™¯','Bâ™­':'Aâ™¯','Fâ™¯':'Fâ™¯','Câ™¯':'Câ™¯','Gâ™¯':'Gâ™¯'};

// Semitone lookup
const NOTE_ST = {
  'C':0,'C#':1,'Câ™¯':1,'Dâ™­':1,'D':2,'D#':3,'Dâ™¯':3,'Eâ™­':3,'E':4,
  'F':5,'F#':6,'Fâ™¯':6,'Gâ™­':6,'G':7,'G#':8,'Gâ™¯':8,'Aâ™­':8,'A':9,
  'A#':10,'Aâ™¯':10,'Bâ™­':10,'B':11
};
function st(note){return NOTE_ST[note]??-1;}

// Chord templates [root offsets]
const CHORD_TEMPLATES = {
  maj:  [0,4,7],
  min:  [0,3,7],
  dom7: [0,4,7,10],
  maj7: [0,4,7,11],
  min7: [0,3,7,10],
  dim:  [0,3,6],
  aug:  [0,4,8],
};

// Score a chroma vector against a chord template rooted at 'root'
function scoreChord(chroma, root, template){
  let score=0, count=0;
  for(const offset of template){
    const idx=(root+offset)%12;
    score += chroma[idx];
    count++;
  }
  // Penalise non-chord notes
  let penalty=0;
  for(let i=0;i<12;i++){
    if(!template.includes(((i-root)+12)%12)) penalty+=chroma[i]*0.3;
  }
  return score/count - penalty;
}

// Detect best chord from chroma vector
function detectChord(chroma){
  let best={root:0,type:'maj',score:-Infinity,name:'?'};
  for(let root=0;root<12;root++){
    for(const [type,template] of Object.entries(CHORD_TEMPLATES)){
      const s=scoreChord(chroma,root,template);
      if(s>best.score){
        best={root,type,score:s,name:CHROMATIC[root]+(type==='maj'?'':type==='min'?'m':type)};
      }
    }
  }
  return best;
}

// Build chroma from FFT buffer
function buildChroma(freqData, sampleRate, fftSize){
  const chroma=new Float32Array(12).fill(0);
  const binHz = sampleRate / fftSize;
  for(let i=1;i<freqData.length;i++){
    const freq = i * binHz;
    if(freq<55||freq>2000) continue;
    const amplitude = Math.pow(10, freqData[i]/20); // dB to linear
    // MIDI note
    const midi = 12*Math.log2(freq/440)+69;
    const pitchClass = ((Math.round(midi)%12)+12)%12;
    chroma[pitchClass] += amplitude;
  }
  // Normalise
  const max=Math.max(...chroma,0.001);
  return chroma.map(v=>v/max);
}

// Expected chord semitone for a given circle index + mode
function expectedChordSemitone(circleIdx, mode){
  if(mode==='min') return st(CIRCLE_MIN[circleIdx].replace('m',''));
  return st(CIRCLE_MAJ[circleIdx].replace('â™­','b').replace('â™¯','#'));
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  PATTERNS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const PATTERNS=[
  {id:'cw12',   name:'Cycle complet â†»',  short:'12â†»', desc:'12 quintes ascendantes',       indices:[0,1,2,3,4,5,6,7,8,9,10,11]},
  {id:'ccw12',  name:'Cycle complet â†º',  short:'12â†º', desc:'12 quartes descendantes',       indices:[0,11,10,9,8,7,6,5,4,3,2,1]},
  {id:'maj3',   name:'Tierces majeures', short:'3M',  desc:'Cycle augmentÃ© Câ€“Eâ€“Aâ™­',         indices:[0,4,8]},
  {id:'dim3',   name:'Tritons Ã—3',        short:'T3',  desc:'Câ€“Eâ™­â€“Fâ™¯â€“A',                    indices:[0,3,6,9]},
  {id:'251',    name:'IIâ€“Vâ€“I majeur',     short:'251', desc:'Dmâ€“Gâ€“C â†’ Amâ€“Dâ€“G â†’â€¦',            indices:[2,7,0,9,2,7,4,9,2]},
  {id:'145',    name:'Iâ€“IVâ€“V blues',      short:'145', desc:'Progression blues / rock',       indices:[0,11,7,7,6,3,5,4,1]},
  {id:'trit',   name:'Saut de triton',    short:'TT',  desc:'Bonds de 6 demi-tons',           indices:[0,6,1,7,2,8,3,9,4,10,5,11]},
  {id:'rnd',    name:'AlÃ©atoire',         short:'RND', desc:'Ordre alÃ©atoire Ã  chaque tour',  indices:[0,1,2,3,4,5,6,7,8,9,10,11], random:true},
];

const CHORD_COLORS=[
  '#FFB300','#FF6D00','#E040FB','#00BCD4','#76FF03','#FF4081',
  '#40C4FF','#FFEA00','#69F0AE','#FF6E40','#EA80FC','#1DE9B6'
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  AUDIO HELPERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function playClick(ctx, isDownbeat, volume=0.7){
  if(!ctx) return;
  const t=ctx.currentTime;
  const osc=ctx.createOscillator();
  const env=ctx.createGain();
  osc.type='sine';
  osc.frequency.value=isDownbeat ? 1200 : 800;
  env.gain.setValueAtTime(volume, t);
  env.gain.exponentialRampToValueAtTime(0.001, t+0.04);
  osc.connect(env);
  env.connect(ctx.destination);
  osc.start(t);
  osc.stop(t+0.05);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SESSION STORAGE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const STORAGE_KEY='quintessence_sessions_v2';

function loadSessions(){
  try{ return JSON.parse(localStorage.getItem(STORAGE_KEY)||'[]'); }
  catch{ return []; }
}

function saveSession(session){
  try{
    const all=loadSessions();
    all.unshift({...session, id:Date.now(), date:new Date().toISOString()});
    localStorage.setItem(STORAGE_KEY, JSON.stringify(all.slice(0,50)));
  }catch(e){console.warn('localStorage unavailable',e);}
}

function clearSessions(){
  try{ localStorage.removeItem(STORAGE_KEY); }catch{}
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  COMPONENTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// â”€â”€ Small button â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function Btn({children, onClick, disabled, style={}}){
  return(
    <button onClick={onClick} disabled={disabled}
      style={{
        width:30,height:30,borderRadius:8,background:'#12121e',
        border:'1px solid #2a2a3a',color:'#888',fontSize:16,
        display:'flex',alignItems:'center',justifyContent:'center',
        cursor:disabled?'not-allowed':'pointer',flexShrink:0,...style
      }}>{children}</button>
  );
}

// â”€â”€ Beat dots â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function BeatDots({count,current,flash}){
  return(
    <div style={{display:'flex',gap:5,alignItems:'center'}}>
      {Array.from({length:count}).map((_,i)=>(
        <div key={i} style={{
          width:i===current?11:7, height:i===current?11:7,
          borderRadius:'50%',
          background:i===current?(flash?'#FFB300':'#9a6d00'):'#1a1a28',
          border:i===0?'1px solid #444':'1px solid #252530',
          boxShadow:i===current&&flash?'0 0 12px #FFB300':'none',
          transition:'all 0.06s',
        }}/>
      ))}
    </div>
  );
}

// â”€â”€ Circle SVG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function CircleDisplay({currentIndex,nextIndex,patternIndices,isRunning,noteStatus,practiceMode}){
  const W=300,cx=150,cy=150;
  const outerR=128,midR=95,innerR=68,outerLabel=111,innerLabel=81;
  const statusGlow=noteStatus==='correct'?'#00E676':noteStatus==='wrong'?'#FF1744':'#FFB300';
  const curName = practiceMode==='min'
    ? CIRCLE_MIN[currentIndex]
    : CIRCLE_MAJ[currentIndex];

  return(
    <svg width={W} height={W} viewBox={`0 0 ${W} ${W}`} style={{overflow:'visible',flexShrink:0}}>
      <defs>
        <radialGradient id="bgr" cx="50%" cy="50%" r="50%">
          <stop offset="0%" stopColor="#14101f"/>
          <stop offset="100%" stopColor="#080810"/>
        </radialGradient>
        <filter id="glow" x="-30%" y="-30%" width="160%" height="160%">
          <feGaussianBlur stdDeviation="3" result="blur"/>
          <feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge>
        </filter>
        <filter id="softglow" x="-50%" y="-50%" width="200%" height="200%">
          <feGaussianBlur stdDeviation="6" result="blur"/>
          <feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge>
        </filter>
      </defs>

      {/* Background */}
      <circle cx={cx} cy={cy} r={outerR+14} fill="url(#bgr)" stroke="#141420" strokeWidth="1"/>

      {/* Segments */}
      {CIRCLE_MAJ.map((note,i)=>{
        const a0=(i*30-90)*Math.PI/180;
        const a1=((i+1)*30-90)*Math.PI/180;
        const isCurrent=i===currentIndex&&isRunning;
        const isNext=i===nextIndex&&isRunning;
        const inPat=patternIndices.includes(i);
        const col=CHORD_COLORS[i];
        const mid=(i*30+15-90)*Math.PI/180;

        const P=(r,a)=>[cx+r*Math.cos(a),cy+r*Math.sin(a)];
        const [x1o,y1o]=P(outerR,a0),[x2o,y2o]=P(outerR,a1);
        const [x1m,y1m]=P(midR,a0), [x2m,y2m]=P(midR,a1);
        const [x1i,y1i]=P(innerR,a0),[x2i,y2i]=P(innerR,a1);

        const outerPath=`M ${x1m} ${y1m} L ${x1o} ${y1o} A ${outerR} ${outerR} 0 0 1 ${x2o} ${y2o} L ${x2m} ${y2m} A ${midR} ${midR} 0 0 0 ${x1m} ${y1m}`;
        const innerPath=`M ${x1i} ${y1i} L ${x1m} ${y1m} A ${midR} ${midR} 0 0 1 ${x2m} ${y2m} L ${x2i} ${y2i} A ${innerR} ${innerR} 0 0 0 ${x1i} ${y1i}`;

        const [lx,ly]=P(outerLabel,mid);
        const [mx,my]=P(innerLabel,mid);

        const outerActive = isCurrent&&practiceMode==='maj';
        const innerActive = isCurrent&&practiceMode==='min';

        return(
          <g key={i}>
            {/* Outer ring = major */}
            <path d={outerPath}
              fill={outerActive?col:isNext&&practiceMode==='maj'?col+'55':inPat?col+'1a':'#0e0e1a'}
              stroke={outerActive?col:inPat?col+'44':'#1a1a28'}
              strokeWidth={outerActive?2:1}
              style={{filter:outerActive?'url(#glow)':'none',transition:'all 0.15s'}}/>
            {/* Inner ring = minor */}
            <path d={innerPath}
              fill={innerActive?col+'cc':isNext&&practiceMode==='min'?col+'44':inPat?col+'15':'#0a0a15'}
              stroke={innerActive?col:inPat?col+'33':'#141420'}
              strokeWidth={innerActive?1.5:0.5}
              style={{filter:innerActive?'url(#glow)':'none',transition:'all 0.15s'}}/>

            {/* Major label */}
            <text x={lx} y={ly} textAnchor="middle" dominantBaseline="middle"
              fontSize={outerActive?13:10} fontWeight={outerActive?700:inPat?500:400}
              fill={outerActive?'#fff':isNext&&practiceMode==='maj'?'#c8c0b0':inPat?col:'#383848'}
              style={{filter:outerActive?'url(#glow)':'none',transition:'fill 0.15s'}}
              fontFamily="Georgia,serif"
            >{note}</text>

            {/* Minor label */}
            <text x={mx} y={my} textAnchor="middle" dominantBaseline="middle"
              fontSize={innerActive?10:8} fontWeight={innerActive?700:400}
              fill={innerActive?'#fff':isNext&&practiceMode==='min'?'#9090b0':inPat?col+'aa':'#252535'}
              style={{filter:innerActive?'url(#glow)':'none',transition:'fill 0.15s'}}
              fontFamily="Georgia,serif"
            >{CIRCLE_MIN[i]}</text>
          </g>
        );
      })}

      {/* Center */}
      <circle cx={cx} cy={cy} r={innerR-3} fill="#080810" stroke="#1a1a28" strokeWidth="1"/>

      {isRunning&&<>
        {noteStatus==='correct'&&(
          <circle cx={cx} cy={cy} r={innerR-3}
            fill="none" stroke="#00E676" strokeWidth="2" strokeOpacity="0.4"
            style={{animation:'ripple 0.6s ease-out'}}/>
        )}
        <circle cx={cx} cy={cy} r={innerR-5}
          fill="none" stroke={statusGlow} strokeWidth="1.5" strokeOpacity="0.35"
          style={{filter:'url(#softglow)'}}/>
        <text x={cx} y={cy-8} textAnchor="middle" dominantBaseline="middle"
          fontSize={30} fontWeight={200} fill={statusGlow}
          fontFamily="Georgia,serif"
          style={{filter:noteStatus==='correct'?'url(#softglow)':'none',transition:'fill 0.15s'}}
        >{curName}</text>
        <text x={cx} y={cy+16} textAnchor="middle" dominantBaseline="middle"
          fontSize={8} fill={statusGlow+'99'} letterSpacing="2.5"
          fontFamily="Georgia,serif"
        >{noteStatus==='correct'?'CORRECT':noteStatus==='wrong'?'RATÃ‰':'Ã‰COUTE'}</text>
      </>}

      {!isRunning&&(
        <text x={cx} y={cy} textAnchor="middle" dominantBaseline="middle"
          fontSize={10} fill="#252535" letterSpacing="3.5" fontFamily="Georgia,serif"
        >QUINTESSENCE</text>
      )}
    </svg>
  );
}

// â”€â”€ Sessions panel â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function SessionsPanel({onClose}){
  const [sessions,setSessions]=useState(loadSessions);

  const handleClear=()=>{
    if(window.confirm('Effacer tout l\'historique ?')){
      clearSessions(); setSessions([]);
    }
  };

  const fmt=dateStr=>{
    const d=new Date(dateStr);
    return d.toLocaleDateString('fr-FR',{day:'2-digit',month:'short',hour:'2-digit',minute:'2-digit'});
  };

  const modeLabel=m=>m==='maj'?'Majeur':m==='min'?'Mineur':'Dom 7';

  return(
    <div style={{
      position:'fixed',inset:0,background:'rgba(0,0,0,0.85)',
      display:'flex',alignItems:'flex-end',zIndex:100,
      backdropFilter:'blur(4px)',
    }} onClick={onClose}>
      <div onClick={e=>e.stopPropagation()} className="fade-in"
        style={{
          width:'100%',maxHeight:'75vh',background:'#0e0e1a',
          borderRadius:'20px 20px 0 0',border:'1px solid #1e1e2e',
          display:'flex',flexDirection:'column',overflow:'hidden',
        }}>
        {/* Header */}
        <div style={{padding:'16px 20px',borderBottom:'1px solid #1a1a2a',display:'flex',justifyContent:'space-between',alignItems:'center'}}>
          <div>
            <div style={{fontSize:13,letterSpacing:3,color:'#9e8b6e',textTransform:'uppercase'}}>Historique</div>
            <div style={{fontSize:10,color:'#444',marginTop:2}}>{sessions.length} session{sessions.length!==1?'s':''}</div>
          </div>
          <div style={{display:'flex',gap:8}}>
            {sessions.length>0&&(
              <button onClick={handleClear}
                style={{padding:'6px 12px',borderRadius:8,background:'rgba(255,23,68,0.1)',
                  border:'1px solid rgba(255,23,68,0.3)',color:'#ff4468',fontSize:11,cursor:'pointer'}}>
                Effacer
              </button>
            )}
            <button onClick={onClose}
              style={{padding:'6px 12px',borderRadius:8,background:'rgba(255,255,255,0.06)',
                border:'1px solid #2a2a3a',color:'#888',fontSize:11,cursor:'pointer'}}>
              Fermer
            </button>
          </div>
        </div>

        {/* List */}
        <div style={{overflowY:'auto',padding:'12px 16px',display:'flex',flexDirection:'column',gap:8}}>
          {sessions.length===0&&(
            <div style={{textAlign:'center',color:'#2a2a3a',padding:'40px 0',fontSize:13,fontStyle:'italic'}}>
              Aucune session enregistrÃ©e
            </div>
          )}
          {sessions.map(s=>{
            const acc=s.score.total>0?Math.round(100*s.score.correct/s.score.total):0;
            const accColor=acc>=80?'#00E676':acc>=50?'#FFB300':'#FF4081';
            return(
              <div key={s.id} style={{
                background:'rgba(255,255,255,0.03)',border:'1px solid #1a1a28',
                borderRadius:12,padding:'12px 14px',
                display:'flex',justifyContent:'space-between',alignItems:'center',
              }}>
                <div>
                  <div style={{fontSize:12,color:'#c8c0b0',marginBottom:3}}>{s.pattern}</div>
                  <div style={{fontSize:10,color:'#444',display:'flex',gap:10}}>
                    <span>{modeLabel(s.mode||s.chordMode||'maj')}</span>
                    <span>â™©={s.bpm}</span>
                    <span>{s.beatsPerChord} temps/accord</span>
                  </div>
                  <div style={{fontSize:9,color:'#2e2e3e',marginTop:3}}>{fmt(s.date)}</div>
                </div>
                <div style={{textAlign:'right'}}>
                  <div style={{fontSize:22,fontWeight:200,color:accColor,fontFamily:'Georgia,serif'}}>{acc}%</div>
                  <div style={{fontSize:9,color:'#444'}}>{s.score.correct}/{s.score.total}</div>
                </div>
              </div>
            );
          })}
        </div>
      </div>
    </div>
  );
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  MAIN APP
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function App(){
  // â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const [tab,setTab]              = useState('practice'); // practice|settings|sessions
  const [practiceMode,setPMode]   = useState('maj');      // maj|min
  const [bpm,setBpm]              = useState(70);
  const [beatsPerChord,setBPC]    = useState(2);
  const [pattern,setPattern]      = useState(PATTERNS[0]);
  const [clickVol,setClickVol]    = useState(0.6);
  const [isRunning,setIsRunning]  = useState(false);
  const [isListening,setIsListen] = useState(false);
  const [currentStep,setStep]     = useState(0);
  const [beat,setBeat]            = useState(0);
  const [flashBeat,setFlash]      = useState(false);
  const [noteStatus,setStatus]    = useState('idle'); // idle|listening|correct|wrong
  const [detectedChord,setDetChord]=useState(null);   // {name, root, type, score}
  const [score,setScore]          = useState({correct:0,total:0});
  const [showSessions,setShowSess]=useState(false);
  const [sessionActive,setSessAct]=useState(null); // session being recorded

  // â”€â”€ Refs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const audioCtxRef    = useRef(null);
  const analyserRef    = useRef(null);
  const streamRef      = useRef(null);
  const sourceRef      = useRef(null);
  const rafRef         = useRef(null);
  const metroRef       = useRef(null);
  const beatCountRef   = useRef(0);
  const stepRef        = useRef(0);
  const patternRef     = useRef(pattern);
  const bpcRef         = useRef(beatsPerChord);
  const bpmRef         = useRef(bpm);
  const modeRef        = useRef(practiceMode);
  const clickVolRef    = useRef(clickVol);
  const scoreRef       = useRef(score);
  const stepResultRef  = useRef('pending');
  const patternIndices = useRef(pattern.indices.slice());

  useEffect(()=>{patternRef.current=pattern;},[pattern]);
  useEffect(()=>{bpcRef.current=beatsPerChord;},[beatsPerChord]);
  useEffect(()=>{bpmRef.current=bpm;},[bpm]);
  useEffect(()=>{modeRef.current=practiceMode;},[practiceMode]);
  useEffect(()=>{clickVolRef.current=clickVol;},[clickVol]);
  useEffect(()=>{scoreRef.current=score;},[score]);

  // â”€â”€ Randomise pattern if needed â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const shufflePattern=useCallback(()=>{
    const idx=[0,1,2,3,4,5,6,7,8,9,10,11];
    for(let i=idx.length-1;i>0;i--){
      const j=Math.floor(Math.random()*(i+1));
      [idx[i],idx[j]]=[idx[j],idx[i]];
    }
    patternIndices.current=idx;
  },[]);

  // â”€â”€ Mic / FFT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const startMic=useCallback(async()=>{
    try{
      const stream=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:false,noiseSuppression:false,autoGainControl:false}});
      streamRef.current=stream;
      const ctx=new (window.AudioContext||window.webkitAudioContext)({sampleRate:44100});
      audioCtxRef.current=ctx;
      const src=ctx.createMediaStreamSource(stream);
      sourceRef.current=src;
      const analyser=ctx.createAnalyser();
      analyser.fftSize=8192;
      analyser.smoothingTimeConstant=0.6;
      analyserRef.current=analyser;
      src.connect(analyser);
      setIsListen(true);

      // Poll FFT
      const freqData=new Float32Array(analyser.frequencyBinCount);
      const poll=()=>{
        analyser.getFloatFrequencyData(freqData);
        // Silence gate: check max level
        const maxDb=Math.max(...freqData.slice(0,500));
        if(maxDb>-50){
          const chroma=buildChroma(freqData,44100,8192);
          const chord=detectChord(chroma);
          if(chord.score>0.25) setDetChord(chord);
        } else {
          setDetChord(null);
        }
        rafRef.current=requestAnimationFrame(poll);
      };
      poll();
    }catch(err){
      alert('AccÃ¨s micro refusÃ© : '+err.message);
    }
  },[]);

  const stopMic=useCallback(()=>{
    cancelAnimationFrame(rafRef.current);
    sourceRef.current?.disconnect();
    analyserRef.current?.disconnect();
    audioCtxRef.current?.close();
    streamRef.current?.getTracks().forEach(t=>t.stop());
    audioCtxRef.current=null;
    setIsListen(false);
    setDetChord(null);
  },[]);

  // â”€â”€ Metronome â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const stopMetronome=useCallback(()=>{
    clearInterval(metroRef.current);
    setIsRunning(false);
    beatCountRef.current=0;
    stepRef.current=0;
    setStep(0); setBeat(0); setStatus('idle');
    stepResultRef.current='pending';
  },[]);

  const startMetronome=useCallback(()=>{
    if(!isListening){alert('Activez le micro d\'abord !');return;}
    beatCountRef.current=0;
    stepRef.current=0;
    stepResultRef.current='pending';
    setStep(0); setBeat(0); setStatus('listening');
    setScore({correct:0,total:0});

    if(patternRef.current.random) shufflePattern();
    else patternIndices.current=patternRef.current.indices.slice();

    // Start session record
    setSessAct({
      pattern:patternRef.current.name,
      mode:modeRef.current,
      bpm:bpmRef.current,
      beatsPerChord:bpcRef.current,
      startTime:Date.now(),
    });

    setIsRunning(true);
    const interval=60000/bpmRef.current;

    metroRef.current=setInterval(()=>{
      const b=beatCountRef.current%bpcRef.current;
      setBeat(b);
      setFlash(true);
      setTimeout(()=>setFlash(false),80);

      // Audio click
      if(audioCtxRef.current){
        playClick(audioCtxRef.current, b===0, clickVolRef.current);
      }

      // Last beat of chord window â†’ evaluate
      if(b===bpcRef.current-1){
        const indices=patternIndices.current;
        const idx=indices[stepRef.current%indices.length];
        const expectedST=expectedChordSemitone(idx,modeRef.current);

        if(stepResultRef.current==='pending'){
          // Check detected chord root matches expected
          // Allow maj/maj7 for maj mode, min/min7 for min mode
          const dc=/* live read */null; // we use a ref trick below
          setDetChord(current=>{
            let correct=false;
            if(current){
              const rootMatch=current.root===expectedST;
              const typeMatch=modeRef.current==='maj'
                ? ['maj','dom7','maj7'].includes(current.type)
                : ['min','min7'].includes(current.type);
              correct=rootMatch&&typeMatch;
            }
            setStatus(correct?'correct':'wrong');
            setScore(s=>{
              const ns={correct:s.correct+(correct?1:0),total:s.total+1};
              scoreRef.current=ns;
              return ns;
            });
            stepResultRef.current='scored';
            return current;
          });
        }

        // Advance
        setTimeout(()=>{
          const indices2=patternIndices.current;
          const nextStep=(stepRef.current+1)%indices2.length;
          if(nextStep===0&&patternRef.current.random) shufflePattern();
          stepRef.current=nextStep;
          setStep(nextStep);
          stepResultRef.current='pending';
          setStatus('listening');
        },120);
      }

      beatCountRef.current++;
    },interval);
  },[isListening,shufflePattern]);

  // Save session on stop
  const handleStop=useCallback(()=>{
    stopMetronome();
    if(sessionActive&&scoreRef.current.total>0){
      saveSession({
        ...sessionActive,
        score:scoreRef.current,
        duration:Math.round((Date.now()-sessionActive.startTime)/1000),
      });
    }
    setSessAct(null);
  },[stopMetronome,sessionActive]);

  useEffect(()=>()=>{stopMetronome();stopMic();},[]);

  // â”€â”€ Derived â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const pIdx    = patternIndices.current;
  const curIdx  = pIdx[currentStep%pIdx.length]??0;
  const nextIdx = pIdx[(currentStep+1)%pIdx.length]??0;
  const curName = practiceMode==='min'?CIRCLE_MIN[curIdx]:CIRCLE_MAJ[curIdx];
  const nxtName = practiceMode==='min'?CIRCLE_MIN[nextIdx]:CIRCLE_MAJ[nextIdx];
  const accuracy= score.total>0?Math.round(100*score.correct/score.total):null;
  const statusColor=noteStatus==='correct'?'#00E676':noteStatus==='wrong'?'#FF1744':noteStatus==='listening'?'#FFB300':'#333';

  // â”€â”€ Render â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  return(
    <div style={{
      fontFamily:"'Georgia','Times New Roman',serif",
      background:'radial-gradient(ellipse at 25% 15%, #1a0e2e 0%, #080810 55%)',
      minHeight:'100vh',color:'#e8dcc8',
      display:'flex',flexDirection:'column',alignItems:'center',
      padding:'12px 14px 24px',gap:'10px',
      userSelect:'none',WebkitUserSelect:'none',
    }}>

      {/* â”€â”€ Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */}
      <div style={{display:'flex',alignItems:'center',justifyContent:'space-between',width:'100%',maxWidth:360,paddingTop:4}}>
        <div>
          <div style={{fontSize:9,letterSpacing:5,color:'#4a3e2e',textTransform:'uppercase'}}>Cycle des quintes</div>
          <div style={{fontSize:18,fontWeight:400,letterSpacing:1,color:'#f5e6c8',lineHeight:1.1}}>Quintessence</div>
        </div>
        <div style={{display:'flex',gap:8,alignItems:'center'}}>
          {/* Micro toggle */}
          <button onClick={isListening?stopMic:startMic}
            style={{
              padding:'7px 14px',borderRadius:10,fontSize:11,
              background:isListening?'rgba(244,67,54,0.15)':'rgba(255,255,255,0.05)',
              border:isListening?'1px solid #F44336aa':'1px solid #2a2a3a',
              color:isListening?'#F44336':'#666',cursor:'pointer',letterSpacing:1,
            }}>
            {isListening?'â¹ Mic':'ğŸ™ Mic'}
          </button>
          {/* Sessions */}
          <button onClick={()=>setShowSess(true)}
            style={{
              width:36,height:36,borderRadius:10,
              background:'rgba(255,255,255,0.04)',border:'1px solid #1e1e2e',
              color:'#666',fontSize:16,cursor:'pointer',
            }}>ğŸ“‹</button>
        </div>
      </div>

      {/* â”€â”€ Practice mode toggle â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */}
      <div style={{display:'flex',width:'100%',maxWidth:360,background:'rgba(255,255,255,0.03)',borderRadius:12,padding:3,gap:3}}>
        {[['maj','Majeur','M'],['min','Mineur','m']].map(([v,label,sup])=>(
          <button key={v} onClick={()=>!isRunning&&setPMode(v)}
            style={{
              flex:1,padding:'8px 0',borderRadius:9,fontSize:12,
              background:practiceMode===v?'rgba(255,179,0,0.18)':'transparent',
              border:practiceMode===v?'1px solid #FFB30066':'1px solid transparent',
              color:practiceMode===v?'#FFB300':'#4a4a5a',cursor:'pointer',
              transition:'all 0.2s',letterSpacing:1,
            }}>
            {label} <sup style={{fontSize:9}}>{sup}</sup>
          </button>
        ))}
      </div>

      {/* â”€â”€ Circle â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */}
      <CircleDisplay
        currentIndex={curIdx} nextIndex={nextIdx}
        patternIndices={pattern.random?[0,1,2,3,4,5,6,7,8,9,10,11]:pattern.indices}
        isRunning={isRunning} noteStatus={noteStatus} practiceMode={practiceMode}
      />

      {/* â”€â”€ Chord readout â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */}
      <div style={{display:'flex',gap:10,width:'100%',maxWidth:360,alignItems:'stretch'}}>
        {/* Current */}
        <div style={{
          flex:1,border:`${noteStatus==='idle'?1:2}px solid ${statusColor}`,
          borderRadius:16,padding:'10px 8px',textAlign:'center',
          background:`rgba(${noteStatus==='correct'?'0,230,118':noteStatus==='wrong'?'255,23,68':'255,179,0'},0.07)`,
          boxShadow:isRunning?`0 0 24px ${statusColor}33`:'none',
          transition:'all 0.18s',
        }}>
          <div style={{fontSize:9,letterSpacing:3,color:'#5a4a3a',marginBottom:3}}>MAINTENANT</div>
          <div style={{fontSize:40,fontWeight:200,color:statusColor,lineHeight:1,fontFamily:'Georgia,serif'}}>
            {isRunning?curName:'â€”'}
          </div>
          <div style={{fontSize:11,color:statusColor,marginTop:4,height:14,opacity:isRunning?1:0}}>
            {noteStatus==='correct'?'âœ“ Correct !':noteStatus==='wrong'?'âœ— RatÃ©':noteStatus==='listening'?'Joueâ€¦':''}
          </div>
        </div>

        {/* Beat + Next */}
        <div style={{display:'flex',flexDirection:'column',gap:8,alignItems:'center',justifyContent:'center',minWidth:60}}>
          <BeatDots count={beatsPerChord} current={isRunning?beat:-1} flash={flashBeat}/>
          {isRunning&&<div style={{fontSize:9,color:'#3a3a4a',letterSpacing:2}}>â™© {bpm}</div>}
        </div>

        <div style={{
          flex:.7,border:'1px solid #1a1a28',borderRadius:16,
          padding:'10px 8px',textAlign:'center',
          background:'rgba(255,255,255,0.02)',
        }}>
          <div style={{fontSize:9,letterSpacing:3,color:'#3a3a4a',marginBottom:3}}>SUIVANT</div>
          <div style={{fontSize:28,fontWeight:200,color:'#4a4a5a',lineHeight:1,fontFamily:'Georgia,serif'}}>
            {isRunning?nxtName:'â€”'}
          </div>
        </div>
      </div>

      {/* â”€â”€ Chord detector readout â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */}
      {isListening&&(
        <div style={{
          width:'100%',maxWidth:360,background:'rgba(255,255,255,0.03)',
          border:'1px solid #1a1a28',borderRadius:12,
          padding:'8px 16px',display:'flex',alignItems:'center',gap:12,
        }}>
          <div style={{
            width:8,height:8,borderRadius:'50%',flexShrink:0,
            background:detectedChord?'#4CAF50':'#1e1e2e',
            boxShadow:detectedChord?'0 0 8px #4CAF5088':'none',
            transition:'all 0.1s',
          }}/>
          <div style={{flex:1}}>
            <div style={{fontSize:9,color:'#3a3a4a',letterSpacing:2}}>ACCORD DÃ‰TECTÃ‰ (FFT)</div>
            <div style={{fontSize:18,color:detectedChord?'#c8e8d8':'#252535',fontFamily:'Georgia,serif',lineHeight:1.2}}>
              {detectedChord?detectedChord.name:'â€”'}
            </div>
          </div>
          {accuracy!==null&&(
            <div style={{textAlign:'right',flexShrink:0}}>
              <div style={{fontSize:18,color:accuracy>=70?'#00E676':accuracy>=40?'#FFB300':'#FF4081',fontFamily:'Georgia,serif'}}>{accuracy}%</div>
              <div style={{fontSize:9,color:'#3a3a4a'}}>{score.correct}/{score.total}</div>
            </div>
          )}
        </div>
      )}

      {/* â”€â”€ Pattern picker â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */}
      <div style={{width:'100%',maxWidth:360}}>
        <div style={{fontSize:9,letterSpacing:3,color:'#3a3a4a',marginBottom:6,textAlign:'center'}}>PATTERN</div>
        <div style={{display:'flex',flexWrap:'wrap',gap:4}}>
          {PATTERNS.map(p=>(
            <button key={p.id} onClick={()=>!isRunning&&setPattern(p)} disabled={isRunning}
              title={p.desc}
              style={{
                padding:'7px 10px',borderRadius:9,fontSize:11,
                background:pattern.id===p.id?'rgba(255,179,0,0.15)':'rgba(255,255,255,0.03)',
                border:pattern.id===p.id?'1px solid #FFB30088':'1px solid #1a1a28',
                color:pattern.id===p.id?'#FFB300':'#4a4a5a',
                cursor:isRunning?'not-allowed':'pointer',
                fontWeight:pattern.id===p.id?600:400,
                transition:'all 0.15s',
              }}>
              {p.short}
            </button>
          ))}
        </div>
        {pattern&&<div style={{fontSize:9,color:'#2e2e3e',marginTop:4,textAlign:'center'}}>{pattern.desc}</div>}
      </div>

      {/* â”€â”€ Controls row â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */}
      <div style={{display:'flex',gap:8,width:'100%',maxWidth:360,flexWrap:'wrap'}}>
        {/* BPM */}
        <div style={{flex:1,background:'rgba(255,255,255,0.03)',borderRadius:12,padding:'8px 10px',minWidth:90}}>
          <div style={{fontSize:9,letterSpacing:2,color:'#3a3a4a',marginBottom:5}}>BPM</div>
          <div style={{display:'flex',alignItems:'center',gap:5}}>
            <Btn onClick={()=>!isRunning&&setBpm(b=>Math.max(30,b-5))}>â€“</Btn>
            <span style={{flex:1,textAlign:'center',fontSize:18,color:'#d8cbb8'}}>{bpm}</span>
            <Btn onClick={()=>!isRunning&&setBpm(b=>Math.min(220,b+5))}>+</Btn>
          </div>
        </div>
        {/* Beats */}
        <div style={{flex:1,background:'rgba(255,255,255,0.03)',borderRadius:12,padding:'8px 10px',minWidth:90}}>
          <div style={{fontSize:9,letterSpacing:2,color:'#3a3a4a',marginBottom:5}}>TEMPS</div>
          <div style={{display:'flex',alignItems:'center',gap:5}}>
            <Btn onClick={()=>!isRunning&&setBPC(b=>Math.max(1,b-1))}>â€“</Btn>
            <span style={{flex:1,textAlign:'center',fontSize:18,color:'#d8cbb8'}}>{beatsPerChord}</span>
            <Btn onClick={()=>!isRunning&&setBPC(b=>Math.min(8,b+1))}>+</Btn>
          </div>
        </div>
        {/* Click volume */}
        <div style={{flex:1.4,background:'rgba(255,255,255,0.03)',borderRadius:12,padding:'8px 10px',minWidth:110}}>
          <div style={{fontSize:9,letterSpacing:2,color:'#3a3a4a',marginBottom:5}}>CLIC â™©</div>
          <div style={{display:'flex',alignItems:'center',gap:6}}>
            <span style={{fontSize:10}}>ğŸ”‡</span>
            <input type="range" min="0" max="1" step="0.05" value={clickVol}
              onChange={e=>setClickVol(+e.target.value)}
              style={{flex:1,accentColor:'#FFB300',cursor:'pointer'}}/>
            <span style={{fontSize:10}}>ğŸ”Š</span>
          </div>
        </div>
      </div>

      {/* â”€â”€ Start / Stop â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */}
      <div style={{display:'flex',gap:10,width:'100%',maxWidth:360}}>
        <button onClick={isRunning?handleStop:startMetronome}
          style={{
            flex:1,padding:'15px 0',borderRadius:14,fontSize:15,fontWeight:600,
            background:isRunning?'rgba(255,23,68,0.2)':'rgba(255,179,0,0.18)',
            border:isRunning?'2px solid #FF1744':'2px solid #FFB300',
            color:isRunning?'#FF6E6E':'#FFB300',cursor:'pointer',letterSpacing:3,
            boxShadow:isRunning?'0 0 24px rgba(255,23,68,0.25)':'0 0 24px rgba(255,179,0,0.18)',
            transition:'all 0.2s',fontFamily:"'Georgia',serif",
          }}>
          {isRunning?'â–   STOP':'â–¶  START'}
        </button>
      </div>

      {/* â”€â”€ Score bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */}
      {score.total>0&&(
        <div className="fade-in" style={{
          width:'100%',maxWidth:360,
          display:'flex',justifyContent:'center',gap:20,
          borderTop:'1px solid #141420',paddingTop:8,
        }}>
          <span style={{fontSize:11,color:'#00E676'}}>âœ“ {score.correct}</span>
          <span style={{fontSize:11,color:'#9e8b6e',fontFamily:'Georgia,serif'}}>
            {accuracy}% prÃ©cision
          </span>
          <span style={{fontSize:11,color:'#FF4081'}}>âœ— {score.total-score.correct}</span>
        </div>
      )}

      {/* â”€â”€ Tip â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */}
      <div style={{fontSize:9,color:'#1e1e2e',textAlign:'center',maxWidth:300,lineHeight:1.5}}>
        FFT multi-frÃ©quences Â· DÃ©tection de qualitÃ© d'accord Â· Clic audio Â· Historique local
      </div>

      {/* â”€â”€ Sessions overlay â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */}
      {showSessions&&<SessionsPanel onClose={()=>setShowSess(false)}/>}
    </div>
  );
}

ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
</script>
</body>
</html>
